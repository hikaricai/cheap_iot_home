# <center>安くて多機能なスマートホーム</center>
------
## 中文简介
闲置Android手机作为智能家具主控，降低系统整体成本。

研究生期间个人兴趣项目，工作一年被裁，正在找新工作，就暂时拿来凑数。

当前repo仅仅是调试阶段的半成品，研究生电子竞赛时拍摄的完整作品演示在B站。

Demo视频 [https://www.bilibili.com/video/BV1Ui4y1s7hC](https://www.bilibili.com/video/BV1Ui4y1s7hC "Demo"). 

## 背景
今のところ、人工知能の高速な発展に従って、色々な知的な装置は家庭にも入っています。例えば、Google Home、Amazon Echoなどのクラウドベースの音声AIアシスタントを備えるスマートスピーカー。しかし、これらの製品には値段の高さ、音声しか交流手段のない、インターネットに依頼する、古い電器が利用できないという欠点があります。Google Homeを命令してエアコンをコントロールするには特定のエアコンが必要となる。そこに、私たちはそれらの製品に啓発され、廉価かつ多機能のソリューションを提出しています。ユーザーは音声やアプリなどの手段で家電操作したり、家を人工知能に任せて便利な生活を満喫したりします。
## 課題
（1）	Android OSを搭載して不用品になった端末（使用者自分で提供する）をMCUに繋げてMCUから電力を獲得させる。データがUSBケーブルを通じて二つの間に流れる。そこにグーグルのAOA（ANDROID OPEN ACCESSORY）プロトコルは不可欠である。

（2）	多数のBLE（bluetooth low energy）モジュールを二分木のデータ構造に組み合わせ、Android端末はこのシステムを制御する。これでBLEモジュールは家の隅まで伸びることがでます。BLEモジュールは赤外線リモートコントローラや温湿度計などの役割を果たせる。

（3）	Android端末は比較的に高性能のハードウェアを持っていますから、知能監視カメラ、音声AIアシスタント、ウェブサーバーなどの仕事を担わせることが可能です。
## 概要
システム概念図

![alt](https://github.com/hikaricai/cheap_iot_home/blob/master/imgs/system_concept.jpg?raw=true)

###### 図１
上の図のように、ユーザーの不用品となったAndroid端末はこのシステムの中心になる。まずはグーグルAOAプロトコルでMCUと繋がって周辺装置と接続することができます。例として、MCUにモーターを付けて端末を動ける監視カメラにする。こうして、端末は家に飼っている猫ちゃんの行動をトラッキングできる。そして端末はMCUから電力をもらいますので、電気切れの心配は無用です。

Android端末は多数のBLEからなる二分木構造ネットワークを制御して家の隅までコントロール信号を発信する。このBLEネットワークは簡単な仕組みの上で高い安定性を持っている。その原理は下の図で説明されています。

![alt](https://github.com/hikaricai/cheap_iot_home/blob/master/imgs/bin_tree.jpg?raw=true)

###### 図2
例えAndroid端末は0x42というロジックアドレスをもつBLEモジュールに送信したいとしたら。データパケットのアドレスに0x42が書かれ、パケットが緑色の線を沿って伝わる。パケットは0x00に到着する時、アドレスの［bit1,bit0］はゼロではないことで下に転送される。方向は［bit1,bit0］が決めるビットによって選ばれる。そのビットは0であれば左に、1であれば右に、パケットが運ばれる。［bit1,bit0］がゼロになるときまでパケット流れつつである。最後に、パケットが0x42のモジュールにたどり着く。逆に、パケットは下から上に伝わると、青い線に従う。

これからAndroid端末におけるウェブサーバーを紹介します。みんなのご存知の通り、Android OSはlinuxのカーネルに基づいて開発されたオペレーティングシステムです。私たちの実験結果によりますと、ほとんどのlinuxソフトウェアがAndroidで操作できます。便利の為、私たちは直接linux deployでubuntuをAndroid端末にインストールした。Google Playにも色んなサーバーがあります。後ではウェブサーバーを私たちのアプリに集積する。
## 実際の効果
まずはウェブにあるページをご覧ください。下の図のように、Android端末は直接にMCUから温湿度を獲得して画面に表現している。そしてAndroid端末は根としてのBLEモジュールと繋がってネットワーク全体を制御する。
![alt](https://github.com/hikaricai/cheap_iot_home/blob/master/imgs/web_deep2.jpg?raw=true)
###### 図3
それに加えて、図４のような形にも変更できます。
![alt](https://github.com/hikaricai/cheap_iot_home/blob/master/imgs/web_deep3.jpg?raw=true)
###### 図4
実際のモジュールの分布は図５に見てください。
![alt](https://github.com/hikaricai/cheap_iot_home/blob/master/imgs/whole_system.jpg?raw=true)
###### 図5
実験によりますと、二つのBLEモジュールの通信距離は障害物なしでは50メートルぐらい。
## コスト
このシステムの一番の特徴はAndroid端末がユーザーに提供されることによってコストの低さです。量産にはBLEモジュール（nrf52832）は約300円、MCU（stm32f401re）は約200円。MCU一つとBLE四つの場合ではコストは2000円以内になる可能性があります。
## TODO
今展示されたプロジェクトは単純なデモに過ぎない。後の仕事はこのシステムに「いのち」と「知能」を入れることを目指しています。今はAndroid端末にtensor flowのデモは一秒以内で画面にある多様なものをトラッキングしながら区別できる。人工知能が流行っている時代にあって、その成果を利用してもっと面白い生活を迎えましょう。
